{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Equation Phase Portrait Tool API Schema",
  "description": "Compact input/output JSON schema for submitting ODE problems and receiving results.",
  "type": "object",
  "definitions": {
    "IntegratorOptions": {
      "type": "object",
      "properties": {
        "method": {"type": "string", "enum": ["RK45","Radau","BDF","DOP853"], "default":"RK45"},
        "rtol": {"type":"number","default":1e-6},
        "atol": {"type":"number","default":1e-9},
        "max_step": {"type":["number","null"]}
      },
      "additionalProperties": false
    },
    "JobRequest": {
      "type":"object",
      "required":["equations","timespan","initial_conditions"],
      "properties":{
        "equations":{"type":"string","description":"Mathematica-like equation(s), e.g. x'[t] == -x[t] + y[t]^2"},
        "parameters":{"type":"object","additionalProperties":{"type":"number"}},
        "timespan":{"type":"array","items":{"type":"number"},"minItems":2,"maxItems":2},
        "initial_conditions":{"type":"array","items":{"type":"array","items":{"type":"number"}}},
        "integrator":{"$ref":"#/definitions/IntegratorOptions"},
        "projection":{"type":"array","items":{"type":"integer"}},
        "animate":{"type":"boolean","default":false}
      },
      "additionalProperties": false
    },
    "JobResult": {
      "type":"object",
      "required":["job_id","times","trajectories"],
      "properties":{
        "job_id":{"type":"string"},
        "times":{"type":"array","items":{"type":"number"}},
        "trajectories":{"type":"array","items":{"type":"array","items":{"type":"array","items":{"type":"number"}}}},
        "meta":{"type":"object"}
      },
      "additionalProperties": false
    }
  },
  "oneOf":[ {"$ref":"#/definitions/JobRequest"}, {"$ref":"#/definitions/JobResult"} ],
  "examples": [
    {
      "equations":"{x'[t], y'[t]} == {x[t] - y[t], x[t]*y[t]}",
      "parameters": {"a":1.0},
      "timespan":[0,10],
      "initial_conditions":[[1,0],[0.5,0.5]],
      "integrator":{"method":"RK45","rtol":1e-6,"atol":1e-9}
    },
    {
      "job_id":"123e4567-e89b-12d3-a456-426614174000",
      "times":[0,0.1,0.2],
      "trajectories":[ [[1,0],[0.9,0]], [[0.5,0.5],[0.45,0.45]] ],
      "meta":{"solver":"mock"}
    }
  ]
}